{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>{{ title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}" />

</head>
<body>
<div class="container-fluid">

    <div class="row" style="text-align: center">
        <div class="col-md-12 col-lg-12">
            <h3>{{ title }}</h3>
            <h5>Breve description ...</h5>
        </div>
    </div>

    <div class="row" style="margin-top: 1em">
        <div class="col-md-3 col-lg-3">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <div class="panel-title">
                        <h4>Settings Data </h4>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-12 col-lg-12">
                            <table class="table table-condensed">
                                <tbody>
                                <tr>
                                    <td style="vertical-align: middle; font-size: 11px"><strong>CSV File:</strong></td>
                                    <td style="vertical-align: middle">
                                    <span id="filename" style="font-size: 12px" class="{% if not csv_file %}label label-danger{% else %}label label-success{% endif %}">
                                        {% if not csv_file %}
                                            Import a csv data file
                                        {% else %}
                                            {{ csv_file.file_name }}
                                        {% endif %}
                                    </span>
                                    </td>
                                    <td>
                                        <a href="/datacsv" class="btn btn-sm {% if not csv_file %}btn-primary{% else %}btn-info{% endif %} tr" title="{% if not csv_file %}Import {% else %}Change {% endif %}File"><i class="glyphicon glyphicon-upload"></i></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="vertical-align: middle; font-size: 11px"><strong>Iterations: </strong></td>
                                    <td>
                                        <input type="text" style="width: 90px; text-align: right; font-size: 13px" class="form-control" name="iterations" id="iterations" value="10000"/>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <table class="table table-bordered table-condensed">
                                <thead>
                                <tr class="well">
                                    <th colspan="5" style="text-align: center">
                                        New Input to predict result
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td style="width: 20%; text-align: center"><input type="text" class="form-control" style="text-align: center" value="0" id="new_input1"/></td>
                                    <td style="width: 20%; text-align: center"><input type="text" class="form-control" style="text-align: center" value="0" id="new_input2"/></td>
                                    <td style="width: 20%; text-align: center"><input type="text" class="form-control" style="text-align: center" value="0" id="new_input3"/></td>
                                    <td style="width: 20%; text-align: center"><input type="text" class="form-control" style="text-align: center" value="0" id="new_input4"/></td>
                                    <td style="width: 20%; text-align: center"><input type="text" class="form-control" style="text-align: center" value="0" id="new_input5"/></td>
                                </tr>
                                </tbody>
                            </table>
                            <a href="#" id="start" class="btn btn-warning btn-block" style="font-size: 17px">
                                <i class="glyphicon glyphicon-asterisk"></i> Start Training
                            </a>
                        </div>
                    </div>
                </div>
            </div> <!-- settings data panel -->
        </div> <!-- tables settings data section -->

        <div class="col-md-5 col-lg-5">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <div class="panel-title">
                        <h4>Neural Network </h4>
                    </div>
                </div>
                <div class="panel-body" style="text-align: center">
                    <img src="{% static 'img/neural.png' %}"/>
                </div>
            </div>
        </div> <!-- neural section -->

        <div class="col-md-4 col-lg-4">
            <table class="table table-condensed table-bordered">
                <thead>
                <tr class="well">
                    <th colspan="5" style="text-align: center"><h4><b>INPUTS</b></h4></th>
                </tr>
                <tr class="well" style="font-size: 14px">
                    <th style="width: 20%; text-align: center">X<span style="vertical-align: sub">1</span></th>
                    <th style="width: 20%; text-align: center">X<span style="vertical-align: sub">2</span></th>
                    <th style="width: 20%; text-align: center">X<span style="vertical-align: sub">3</span></th>
                    <th style="width: 20%; text-align: center">X<span style="vertical-align: sub">4</span></th>
                    <th style="width: 20%; text-align: center">X<span style="vertical-align: sub">5</span></th>
                </tr>
                </thead>
                <tbody>
                <tr style="font-size: 17px; font-weight: bold">
                    <td style="text-align: center">0</td>
                    <td style="text-align: center">0</td>
                    <td style="text-align: center">0</td>
                    <td style="text-align: center">0</td>
                    <td style="text-align: center">0</td>
                </tr>
                </tbody>
            </table>
            <table class="table table-condensed table-bordered">
                <thead>
                <tr class="well">
                    <th colspan="5" style="text-align: center"><h4><b>WEIGHTS</b></h4></th>
                </tr>
                <tr class="well" style="font-size: 12px">
                    <th style="width: 20%; text-align: center">W<span style="vertical-align: sub">1</span></th>
                    <th style="width: 20%; text-align: center">W<span style="vertical-align: sub">2</span></th>
                    <th style="width: 20%; text-align: center">W<span style="vertical-align: sub">3</span></th>
                    <th style="width: 20%; text-align: center">W<span style="vertical-align: sub">4</span></th>
                    <th style="width: 20%; text-align: center">W<span style="vertical-align: sub">5</span></th>
                </tr>
                </thead>
                <tbody>
                <tr style="font-size: 14px">
                    <td style="text-align: center">0.000000</td>
                    <td style="text-align: center">0.000000</td>
                    <td style="text-align: center">0.000000</td>
                    <td style="text-align: center">0.000000</td>
                    <td style="text-align: center">0.000000</td>
                </tr>
                </tbody>
            </table>
            <table class="table table-bordered table-condensed">
                <thead>
                <tr class="well">
                    <th colspan="2" style="text-align: center"><h4><b>RESULTS</b></h4></th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td style="width: 40%"><strong>% ERROR</strong></td>
                    <td style="text-align: right">
                        <span id="weights_average" style="font-size: 17px; font-weight: bold">
                            {% if weights_average %}{{ weights_average }}{% else %}0.00{% endif %}
                        </span>
                    </td>
                </tr>
                <tr>
                    <td><strong>FINAL WEIGHT</strong></td>
                    <td style="text-align: right">
                        <span id="value_with_train" style="margin-left: 2em; font-size: 17px; font-weight: bold">
                            {% if value_with_train %}{{ value_with_train }}{% else %}0.000000{% endif %}
                        </span>
                    </td>
                </tr>
                <tr>
                    <td><strong>ESTIMATE RESULT</strong></td>
                    <td style="text-align: right">
                        <span id="possible_result" style="margin-left: 2em; font-size: 20px; font-weight: bold">
                            {% if possible_result %}{{ possible_result }}{% else %}0{% endif %}
                        </span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>

<script>

    $(function () {

        numerico = function(elemento, min, max, decimales) {
            var nvalor;
            var valor = elemento.val();
            if (valor==""){
                valor = parseFloat(min).toFixed(decimales);
                elemento.val(valor);
                return;
            }
            if (isNaN(valor)){
                nvalor = parseFloat(min).toFixed(decimales);
                elemento.val(nvalor);
                return;
            }
            if (valor < min) {
                nvalor = parseFloat(min).toFixed(decimales);
                elemento.val(nvalor);
                return;
            }
            if (max>0 && valor>max){
                nvalor = parseFloat(max).toFixed(decimales);
                elemento.val(nvalor);
                return;
            }
            nvalor = parseFloat(valor).toFixed(decimales);
            elemento.val(nvalor);
        };

        $("#iterations").blur(function(){
            numerico($(this), 10, 100000000, 0);
        });

        $("#new_input1, #new_input2, #new_input3, #new_input4, #new_input5").blur(function(){
            numerico($(this), 0, 1, 0);
        });

        $(".tt").tooltip({placement:"top"});
        $(".tb").tooltip({placement:"bottom"});
        $(".tr").tooltip({placement:"right"});
        $(".tl").tooltip({placement:"left"});

        $("#start").click(function () {
            var iter = $("#iterations").val();
            var n1 = $("#new_input1").val();
            var n2 = $("#new_input2").val();
            var n3 = $("#new_input3").val();
            var n4 = $("#new_input4").val();
            var n5 = $("#new_input5").val();

            $.ajax({
                type: "POST",
                url: "/training",
                async:true,
                data: {'n1': n1, 'n2': n2, 'n3': n3, 'n4': n4, 'n5': n5, 'iter': iter},
                success: function(data) {
                    if (data.result == 'ok') {
                        $("#weights_average").html(data.weights_average);
                        $("#value_with_train").html(data.value_with_train);
                        $("#possible_result").html(data.possible_result);
                    } else {
                        alert(data.mensaje);
                    }
                },
                error: function() {
                    alert(data.mensaje);
                },
                dataType: "json"
            });

        });

    });
</script>
</body>
</html>